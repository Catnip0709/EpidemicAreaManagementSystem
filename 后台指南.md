# 一、基本信息
1、后台框架：https://github.com/yhirose/cpp-httplib  
2、json库：https://github.com/Tencent/rapidjson  
3、服务器：腾讯云  
4、ip：49.233.211.29  

# 二、后端构建方式
clone项目下来以后  
```
mkdir build
cd build
```

每次需要构建时在build中执行  
```
./build.sh
```

得到可执行文件，在build/bin之中  
通过以下命令启动可执行文件  
```
./CHttpServer [端口号]
```

# 三、后端接口规范
## 1、普通用户注册 userRegister  
+ 参数  {"userID":"45222319907090049","userName":"张三","password":"123456","phone":"13347729889","buildingID":"20","familyID":"22"}  
string userID           18位身份证号  
string userName         姓名  
string password         密码   
string phone            手机号  
int buildingID          居住栋号  
int familyID            居住户号  
+ 返回值   {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
BEEN_REGISTER 1000      该身份证已被注册过  
+ 测试命令  
curl localhost:9779/userRegister -X POST -H "Content-Type:application/json" -d '"userID":"452223000907095222","userName":"张三三","password":"1234567","phone":"13347729889","buildingID":"1","familyID":"2"'  

## 2、管理员注册 adminRegister  
+ 参数  {"userID":"45222319907090049","userName":"张三","password":"123456","phone":"13347729889","buildingID":"11_20_25"}  
string userID           18位身份证号  
string userName         姓名  
string password         密码  
string phone            手机号  
int buildingID          管理的栋号（多栋以下划线分割）  
+ 返回值   {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
BEEN_REGISTER 1000      该身份证已被注册过  
+ 测试命令  
curl localhost:9779/adminRegister -X POST -H "Content-Type:application/json" -d '"userID":"452223199907095222","userName":"catnip","password":"1234567","phone":"13347729889","buildingID":"1_2"'  

## 3、登录 login （普通用户和管理员通用）  
+ 参数  {"userID":"45222319907090049","password":"123456","isAdmin = "0"}  
string userID           18位身份证号  
string password         密码  
string isAdmin          区分普通用户登录和管理员登录（"0" = 普通用户，"1" = 管理员）  
+ 返回值   {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该身份证账号尚未注册  
PWD_ERR 1002            登录密码错误  
DATA_ERR 1003           数据库数据有误  
+ 测试命令  
curl localhost:9779/login -X POST -H "Content-Type:application/json" -d '"userID":"452223199907095222","password":"1234567","isAdmin":"1"'  

## 4、新增公告  newAnnouncement  
+ 参数  {"title":"重要公告","content":"1234567","state":"紧急","date":"2020-05-23"}  
string title            公告标题  
string content          公告内容  
string state            公告重要等级    
string date             公告发布日期  
+ 返回值    {"result":0,"id":2}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
（2）id取值  
ERROR -1                result不为0时id = -1，否则id为后台为该条新增公告生成的id  
+ 测试命令  
curl localhost:9779/newAnnouncement -X POST -H "Content-Type:application/json" -d '"title":"重要公告","content":"99889988","state":"紧急","date":"2020-05-23"'  

## 5、修改公告  modifyAnnouncement  
+ 参数  {"id":"1","title":"重要公告","content":"1234567","state":"紧急","date":"2020-05-23"}  
string id               公告id  
string title            公告标题  
string content          公告内容  
string state            公告重要等级  
string date             公告发布日期  
+ 返回值    {"result":0}  
（1）result取值  
SUCCESS 0               成功  
HAVENT_REGISTER 1001    请求修改的公告id尚未注册（无该公告）  
MYSQL_ERR -2            MYSQL执行失败  
+ 测试命令  
curl localhost:9779/modifyAnnouncement -X POST -H "Content-Type:application/json" -d '"id":"4","title":"重要公告","content":"11111222","state":"重要","date":"2020-05-23"'  

## 6、删除公告  deleteAnnouncement  
+ 参数  {"id":"1"}  
string id               公告id  
+ 返回值    {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  

## 7、增加或减少某管理员所管理的栋号 modifyInchargeBuilding （暂时忽略这个功能）
+ 参数  {"userID":"452223199504090102","buildingID":22,"isAdd":1}  
string userID           管理员身份证号  
int buildingID          目标栋号  
bool isAdd              添加or删去对该栋号的管理权限（0：删去，1：添加）  
+ 返回值    {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该用户id尚未注册  
DATA_ERR 1003           数据库有问题（如读取到2个id相同的人，一般不会出现该情况）  
ILLEGAL_REQUEST 1005    非法请求：isAdd非法（只能是"0"或"1"）  
NOT_ADMINISTRATOR 1006  该用户id不是管理员  
+ 测试命令  
curl localhost:9779/modifyInchargeBuilding -X POST -H "Content-Type:application/json" -d '"userID":"452223199907091222","buildingID":"1","isAdd":"1"'  

## 8、每日信息上报 physicalCondition  
+ 参数  {"userID":"452223199504090102","date":"2020-05-24","todayTemperature":"36.5","HuBeiContact":"0"}   
string userID           上报人身份证号   
string date             上报日期   
string todayTemperature 当日体温   
string HuBeiContact     是否接触湖北籍人民（"0"：否，"1"：是）  
+ 返回值    {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该用户id尚未注册  
DATA_ERR 1003           数据库有问题（如读取到2个id相同的人，一般不会出现该情况）  
+ 测试命令  
curl localhost:9779/physicalCondition -X POST -H "Content-Type:application/json" -d '"userID":"452223199907095222","date":"2020-05-24","todayTemperature":"36.5","HuBeiContact":"0"'  

## 9、管理员新增一种物资 newEquipment  
+ 参数  {"equipmentName":"防护手套","storage":"100"}   
string equipmentName    新物资名称   
string storage          新物资存量   
+ 返回值    {"result":0,"equipmentID":5}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
（2）id取值  
ERROR -1                result不为0时id = -1，否则id为后台为该条新增物资生成的id  
+ 测试命令  
curl localhost:9779/newEquipment -X POST -H "Content-Type:application/json" -d '"equipmentName":"mask","storage":"100"'  

## 10、管理员修改物资信息 modifyEquipment  
+ 参数  {"equipmentID":"2","storageChange":"-4"}   
string equipmentID      目标物资ID  
string storageChange    物资变化量（变多+4,变少-4）  
+ 返回值    {"result":0}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该物资id尚未注册  
+ 测试命令  
curl localhost:9779/modifyEquipment -X POST -H "Content-Type:application/json" -d '"equipmentID":"1","storageChange":"-4"'  

## 11、人民提出物资申请 applyEquipment  
+ 参数  {"userID":"452232199909090089","equipmentName":"口罩","number":"3","date":"2020-03-03"}  
string userID           申请人身份证   
string equipmentName    物资名称
string number           申请数量  
string date             申请日期  
+ 返回值    {"result":0,"applyID":10000}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该用户id尚未注册  
（2）applyID订单号取值  
ERROR -1                result不为0时applyID = -1，否则applyID为后台为该条申请生成的id  
+ 测试命令  
curl localhost:9779/applyEquipment -X POST -H "Content-Type:application/json" -d '"userID":"452232199909090089","equipmentName":"mask","amount":"3","date":"2020-03-03"'  

## 12、管理员读取管理的栋的所有物资申请列表 getApplyEquipment
+ 参数 {"adminID":"452223199909090099"}
string adminID          管理员身份证
+ 返回值    {"result":0,"applyNum":2,"applyInfo":}
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该adminID尚未注册管理员身份  
（2）applyNum 申请信息条数  
ERROR -1                result不为0时applyNum = -1，否则为申请条数  
（3）applyInfo  申请列表的信息，是个数组