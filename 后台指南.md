# 一、基本信息
1、后台框架：https://github.com/yhirose/cpp-httplib  
2、json库：https://github.com/Tencent/rapidjson  
3、服务器：腾讯云  
4、ip：49.233.211.29  

# 二、后端构建方式
clone项目下来以后  
```
mkdir build
cd build
```

每次需要构建时在build中执行  
```
./build.sh
```

得到可执行文件，在build/bin之中  
通过以下命令启动可执行文件  
```
./CHttpServer [端口号]
```

# 三、后端接口规范
## 1、普通用户注册 userRegister  
+ 参数  {"userID":"45222319907090049","userName":"张三","password":"123456","phone":"13347729889","buildingID":"20","familyID":"22", "state":"1"}  
string userID           18位身份证号  
string userName         姓名  
string password         密码   
string phone            手机号  
int buildingID          居住栋号  
int familyID            居住户号  
int state               当前健康状况（1=健康、2=隔离、3=疑似、4=确诊、5=死亡）  
+ 返回值   {"result":"0"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
BEEN_REGISTER 1000      该身份证已被注册过  
+ 测试命令  
curl localhost:9779/userRegister -X POST -H "Content-Type:application/json" -d '"userID":"452223000907095222","userName":"张三三","password":"1234567","phone":"13347729889","buildingID":"1","familyID":"2","state":"1"'  

## 2、管理员注册 adminRegister  
+ 参数  {"userID":"45222319907090049","userName":"张三","password":"123456","phone":"13347729889","buildingID":"11_20_25"}  
string userID           18位身份证号  
string userName         姓名  
string password         密码  
string phone            手机号  
string buildingID       管理的栋号（多栋以下划线分割）  
+ 返回值   {"result":"0"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
BEEN_REGISTER 1000      该身份证已被注册过  
+ 测试命令  
curl localhost:9779/adminRegister -X POST -H "Content-Type:application/json" -d '"userID":"111111111111111111","userName":"catnip","password":"1234567","phone":"13347729889","buildingID":"1_2_3"'  

## 3、登录 login （普通用户和管理员通用）  
+ 参数  {"userID":"45222319907090049","password":"123456","isAdmin = "0"}  
string userID           18位身份证号  
string password         密码  
string isAdmin          区分普通用户登录和管理员登录（"0" = 普通用户，"1" = 管理员）  
+ 返回值   {"result":"0"}   
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该身份证账号尚未注册  
PWD_ERR 1002            登录密码错误  
DATA_ERR 1003           数据库数据有误  
+ 测试命令  
curl localhost:9779/login -X POST -H "Content-Type:application/json" -d '"userID":"452223199907095222","password":"1234567","isAdmin":"1"'  

## 4、新增公告  newAnnouncement  
+ 参数  {"title":"重要公告","content":"1234567","state":"紧急","date":"2020-05-23"}  
string title            公告标题  
string content          公告内容  
string state            公告重要等级    
string date             公告发布日期  
+ 返回值    {"result":"0","id":"2"}  或  {"result":"-2"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
（2）id取值  
result为0是id为新增公告的id，result不为0时无该项  
+ 测试命令  
curl localhost:9779/newAnnouncement -X POST -H "Content-Type:application/json" -d '"title":"important","content":"99889988","state":"important","date":"2020-05-23"'  

## 5、修改公告  modifyAnnouncement  
+ 参数  {"id":"1","title":"重要公告","content":"1234567","state":"紧急","date":"2020-05-23"}  
string id               公告id  
string title            公告标题  
string content          公告内容  
string state            公告重要等级  
string date             公告发布日期  
+ 返回值    {"result":"0"}    
（1）result取值  
SUCCESS 0               成功  
HAVENT_REGISTER 1001    请求修改的公告id尚未注册（无该公告）  
MYSQL_ERR -2            MYSQL执行失败  
+ 测试命令  
curl localhost:9779/modifyAnnouncement -X POST -H "Content-Type:application/json" -d '"id":"4","title":"重要公告","content":"11111222","state":"重要","date":"2020-05-23"'  

## 6、删除公告  deleteAnnouncement  
+ 参数  {"id":"1"}  
string id               公告id  
+ 返回值    {"result":"0"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  

## 7、增加或减少某管理员所管理的栋号 modifyInchargeBuilding （暂时忽略这个功能）
+ 参数  {"userID":"452223199504090102","buildingID":22,"isAdd":1}  
string userID           管理员身份证号  
int buildingID          目标栋号  
bool isAdd              添加or删去对该栋号的管理权限（0：删去，1：添加）  
+ 返回值    {"result":"0"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该用户id尚未注册  
DATA_ERR 1003           数据库有问题（如读取到2个id相同的人，一般不会出现该情况）  
ILLEGAL_REQUEST 1005    非法请求：isAdd非法（只能是"0"或"1"）  
NOT_ADMINISTRATOR 1006  该用户id不是管理员  
+ 测试命令  
curl localhost:9779/modifyInchargeBuilding -X POST -H "Content-Type:application/json" -d '"userID":"452223199907091222","buildingID":"1","isAdd":"1"'  

## 8、每日信息上报 physicalCondition  
+ 参数  {"userID":"452223199504090102","date":"2020-05-24","todayTemperature":"36.5","HuBeiContact":"0"}   
string userID           上报人身份证号   
string date             上报日期   
string todayTemperature 当日体温   
string HuBeiContact     是否接触湖北籍人民（"0"：否，"1"：是）  
+ 返回值    {"result":"0"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该用户id尚未注册  
DATA_ERR 1003           数据库有问题（如读取到2个id相同的人，一般不会出现该情况）  
+ 测试命令  
curl localhost:9779/physicalCondition -X POST -H "Content-Type:application/json" -d '"userID":"452223199907095222","date":"2020-05-24","todayTemperature":"36.5","HuBeiContact":"0"'  

## 9、管理员新增一种物资 newEquipment  
+ 参数  {"equipmentName":"防护手套","storage":"100"}   
string equipmentName    新物资名称   
string storage          新物资存量   
+ 返回值    {"result":"0","equipmentID":"5"}   或  {"result":"-2"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
（2）equipmentID取值  
result为0时id为新增物资的equipmentID，result不为0时无该项  
+ 测试命令  
curl localhost:9779/newEquipment -X POST -H "Content-Type:application/json" -d '"equipmentName":"cloth","storage":"200"'  

## 10、管理员修改物资库存 modifyEquipment  
+ 参数  {"equipmentID":"2","storageChange":"-4"}   
string equipmentID      目标物资ID  
string storageChange    物资变化量（变多+4,变少-4）  
+ 返回值   {"result":"0"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该物资id尚未注册  
+ 测试命令  
curl localhost:9779/modifyEquipment -X POST -H "Content-Type:application/json" -d '"equipmentID":"1","storageChange":"-3"'  

## 11、人民提出物资申请 applyEquipment  
+ 参数  {"userID":"452232199909090089","equipmentName":"口罩","amount":"3","date":"2020-03-03"}  
string userID           申请人身份证   
string equipmentName    物资名称  
string amount           申请数量  
string date             申请日期  
+ 返回值    {"result":"0","applyID":"10000"}   或  {"result":"-2"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该用户id尚未注册  
（2）applyID订单号取值  
result为0时id为新建的订单号ID，result不为0时无该项  
+ 测试命令  
curl localhost:9779/applyEquipment -X POST -H "Content-Type:application/json" -d '"userID":"452223199907095222","equipmentName":"mask","amount":"33","date":"2020-03-03"'  

## 12、管理员读取管理的栋的所有物资申请列表 getApplyEquipment  
+ 参数 {"adminID":"452223199909090099"}  
string adminID          管理员身份证  
+ 返回值    
成功时：
{"result":"0", "applyNum":"4","applyInfo":[{"applyID":"9999","userID":"452223199707090000","equipmentName":"??","amount":"3","date":"2020-05-28","state":"2"},{"applyID":"10000","userID":"452223199907095222","equipmentName":"mask","amount":"33","date":"2020-03-03","state":"2"},{"applyID":"10001","userID":"452223199907095222","equipmentName":"mask","amount":"44","date":"2020-03-03","state":"2"},{"applyID":"10002","userID":"452223199907095222","equipmentName":"mask","amount":"33","date":"2020-03-03","state":"2"}]} 
失败时：{"result":"-2"}  
（1）result取值  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    该adminID尚未注册管理员身份  
（2）applyNum 申请信息条数  
（3）applyInfo  申请列表的信息  
applyID：物资申请订单号
userID：申请人身份证  
equipmentName：申请的物品名称  
amount：申请数量  
date：申请日期  
state：当前订单状态（0：已驳回；1：已同意；2：未处理）  
+ 测试命令  
curl localhost:9779/getApplyEquipment -X POST -H "Content-Type:application/json" -d '"adminID":"452223199907095222"'  

## 13、管理员处理某一物资申请（同意/驳回） handleApplication
+ 参数  {"applyID":"10001","result":"1","adminID":"452223199909090049","reply":"haha","date":"2020-05-20"}  
string applyID          申请订单ID  
string result           处理结果（"0"：驳回，"1"：同意）  
string adminID          处理人（管理员身份证）  
string reply            管理员回执  
string date             处理日期  
+ 返回值  {"result":"0"}  
SUCCESS 0               成功  
MYSQL_ERR -2            MYSQL执行失败  
HAVENT_REGISTER 1001    不存在该订单ID  
+ 测试命令  
curl localhost:9779/handleApplication -X POST -H "Content-Type:application/json" -d '"applyID":"10000","result":"1","adminID":"452232199909090089","reply":"1234","date":"2020-03-03"'  

## 14、查看负责区域疫情状况（统计分析）  epidemicSituation
+ 参数
string date             当天日期

+ 返回值
{
    "todayList": {
      "completed": 123,
      "uncompleted": 145,
    },
    "todayIncrease": {   //2=隔离、3=疑似、4=确诊、5=死亡
        "segregation": 7 // 隔离
        "suspected": 3,  // 疑似
        "diagnosis": 1,  // 确诊
        "die": 2,        // 死亡
    },
    "total": {
      "segregation": 11,  
      "suspected": 39,
      "diagnosis": 28,
      "die": 72
    },
    "date": ["2020-02-01", "2020-02-02", "2020-02-03", "2020-02-04", "2020-02-05", "2020-02-06", "2020-02-07", "2020-02-08"],
    "trend":[
      {
        "label": "隔离",
        "data": [0, 8, 26 ,31 ,42, 57, 81, 160]
      },
      {
        "label": "疑似",
        "data": [0, 3, 15,28 ,39, 50, 71,97]
      },
      {
        "label": "确诊",
        "data": [0, 1, 7, 18 ,26, 34, 60 ,81]
      },
      {
        "label": "死亡",
        "data": [0, 0, 0, 1 ,6, 11, 21 ,27]
      }
    ]
}